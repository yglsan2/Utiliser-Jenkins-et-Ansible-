Introduction 

Dans ce tutoriel, nous allons apprendre Ã  automatiser un dÃ©ploiement d'application en utilisant Jenkins et Ansible.

Jenkins, c'est un outil d'intÃ©gration continue qui permet d'automatiser diffÃ©rentes Ã©tapes du cycle de dÃ©veloppement logiciel (construction, test, dÃ©ploiement).

Ansible âš™ï¸ est un outil d'automatisation qui permet de configurer des serveurs et de dÃ©ployer des applications sans nÃ©cessiter d'installation d'agent sur les machines distantes.

L'objectif ici est de faire travailler ces deux outils ensemble pour que Jenkins puisse dÃ©clencher un playbook Ansible permettant de dÃ©ployer automatiquement une application sur un serveur distant.


Pourquoi utiliser Jenkins et Ansible ensemble ?

Jenkins et Ansible : Deux outils complÃ©mentaires

Dans le monde du DevOps et de l'automatisation, Jenkins et Ansible sont souvent utilisÃ©s ensemble pour plusieurs raisons essentielles :

Jenkins est un orchestrateur puissant qui permet d'exÃ©cuter des tÃ¢ches automatisÃ©es selon des dÃ©clencheurs prÃ©cis, comme un commit dans un dÃ©pÃ´t Git.

Ansible est un outil de gestion de configuration et de dÃ©ploiement qui exÃ©cute des tÃ¢ches sur des serveurs distants sans nÃ©cessiter d'installation spÃ©cifique (contrairement Ã  Puppet ou Chef).

Combiner Jenkins et Ansible permet de crÃ©er un pipeline CI/CD robuste et flexible, oÃ¹ Jenkins orchestre l'exÃ©cution des tÃ¢ches et Ansible les exÃ©cute de maniÃ¨re fiable et reproductible.

Pourquoi ne pas utiliser seulement Jenkins ou Ansible ?

Jenkins seul : Bien qu'il puisse exÃ©cuter des scripts shell pour dÃ©ployer une application, il ne fournit pas une gestion avancÃ©e de l'infrastructure et des configurations des serveurs.

Ansible seul : Il est excellent pour la configuration et le dÃ©ploiement, mais il n'offre pas de mÃ©canisme de dÃ©clenchement automatique basÃ© sur des Ã©vÃ©nements liÃ©s au code source.

En rÃ©sumÃ©, Jenkins joue le rÃ´le de chef d'orchestre et Ansible celui d'exÃ©cutant, garantissant ainsi un dÃ©ploiement fluide et automatisÃ© de bout en bout.

1ï¸âƒ£ SchÃ©ma de fonctionnement ğŸ“Œ

Pour bien comprendre comment Jenkins et Ansible interagissent, voici un schÃ©ma simple du processus :

[DÃ©veloppeur] ---> [Push code sur Git] ---> [Jenkins dÃ©tecte le changement] ---> [ExÃ©cute un job Jenkins] ---> [Lance un playbook Ansible] ---> [DÃ©ploie sur serveur distant]

Un dÃ©veloppeur effectue une modification dans le code source et pousse ses changements dans un dÃ©pÃ´t Git.

Jenkins dÃ©tecte cette modification et dÃ©clenche un pipeline d'intÃ©gration continue.

Ce pipeline contient une Ã©tape oÃ¹ Ansible exÃ©cute un playbook qui effectue des actions sur un serveur distant.

L'application est dÃ©ployÃ©e automatiquement, sans intervention manuelle.


2ï¸âƒ£ PrÃ©-requis ğŸ› ï¸

Avant de commencer, assure-toi d'avoir :

âœ… Un serveur avec Jenkins installÃ© et en cours d'exÃ©cution.âœ… Un serveur distant oÃ¹ Ansible va dÃ©ployer l'application.âœ… Un accÃ¨s SSH sans mot de passe entre Jenkins et le serveur distant (explications dÃ©taillÃ©es plus bas).âœ… Une application simple Ã  dÃ©ployer (un site web statique par exemple).

3ï¸âƒ£ Installation de Jenkins ğŸ—ï¸

Jenkins fonctionne avec Java, donc il faut d'abord installer Java avant Jenkins.

ğŸ“Œ Sur Ubuntu/Debian

sudo apt update && sudo apt install openjdk-11-jdk -y
wget -q -O - https://pkg.jenkins.io/debian/jenkins.io.key | sudo apt-key add -
sudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'
sudo apt update && sudo apt install jenkins -y
sudo systemctl start jenkins
sudo systemctl enable jenkins

ğŸ“Œ VÃ©rifier si Jenkins fonctionne

Une fois installÃ©, Jenkins doit Ãªtre accessible via un navigateur :

URL d'accÃ¨s : http://localhost:8080

Pour rÃ©cupÃ©rer le mot de passe initial :

sudo cat /var/lib/jenkins/secrets/initialAdminPassword

Ensuite, suivre l'assistant d'installation et installer les plugins recommandÃ©s.

4ï¸âƒ£ Installation d'Ansible âš™ï¸

Ansible doit Ãªtre installÃ© sur la machine qui exÃ©cutera les commandes (gÃ©nÃ©ralement Jenkins ou un serveur d'administration dÃ©diÃ©).

ğŸ“Œ Sur Ubuntu/Debian

sudo apt update && sudo apt install ansible -y

ğŸ“Œ Tester l'installation

VÃ©rifie qu'Ansible fonctionne correctement avec :

ansible --version

5ï¸âƒ£ Configuration SSH entre Jenkins et le serveur distant ğŸ”‘

Ansible utilise SSH pour se connecter aux serveurs distants. Il est donc important de configurer une connexion sans mot de passe pour permettre Ã  Jenkins d'exÃ©cuter les commandes automatiquement.

ğŸ“Œ GÃ©nÃ©rer une clÃ© SSH

Sur la machine Jenkins :

sudo su - jenkins
ssh-keygen -t rsa -b 4096

Laisse les champs vides (appuie sur EntrÃ©e plusieurs fois).

ğŸ“Œ Copier la clÃ© sur le serveur distant

ssh-copy-id user@remote-server

Teste la connexion SSH :

ssh user@remote-server

Si la connexion fonctionne sans demander de mot de passe, tout est bon ! âœ…

6ï¸âƒ£ CrÃ©er un Playbook Ansible ğŸ“

Un playbook est un fichier YAML qui dÃ©crit les tÃ¢ches Ã  exÃ©cuter sur un serveur.

CrÃ©e un fichier deploy.yml :

---
- name: DÃ©ploiement d'une application
  hosts: webservers
  become: yes
  tasks:
    - name: Copier les fichiers de l'application
      copy:
        src: /var/lib/jenkins/workspace/app/
        dest: /var/www/html/
    
    - name: RedÃ©marrer le service web
      systemd:
        name: apache2
        state: restarted

Ajoute ton serveur dans /etc/ansible/hosts :

[webservers]
192.168.1.100 ansible_user=user

ğŸ“š Ressources complÃ©mentaires

Documentation officielle de Jenkins : https://www.jenkins.io/doc/

Documentation officielle de Ansible : https://docs.ansible.com/
